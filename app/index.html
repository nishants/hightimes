<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="css/app.css">

    <script src="js/lib/jquery.js"></script>

    <script src="js/hightimes.js"></script>
    <script src="js/user-activity-matrix.js"></script>
    <script src="js/promise.js"></script>

    <script src="js/instagram/instagram.js"></script>
    <script src="js/instagram/page.js"></script>
    <script src="js/instagram/paged-resource.js"></script>

    <script src="js/views/modal.js"></script>
    <script src="js/views/login-page.js"></script>
    <script src="js/views/dashboard-page.js"></script>

    <script src="js/mock.js"></script>
</head>

<body>

<div id="login-page" class="centered img-background img-bg-blue-lit full-screen hidden" action="">
    <img id="brand" src="images/hightimes-logo.gif" class="undo-image"/>

    <div class="attached-input-label">
        <input id="user-id" placeholder="Instgram Id" class="row"/>
        <button id="login-by-id">Go</button>
    </div>

    <div class="attached-input-label">
        <input id="username" placeholder="Instagram username" class="row"/>
        <button id="login-by-name">Go</button>
    </div>
</div>

<div id="dashboard-page" class="centered img-background img-bg-blue-lit full-screen hidden" action="">
    <div id="user-profile">
        <img id="user-profile-pic" src=""/>

        <p id="userfullname"></p>
    </div>

    <!--TODO instead of monday, counting must start from sunday.-->
    <div id="monday" class="weekday ">
        <div class="indicator" id="indicator00"></div>
        <div class="indicator" id="indicator01"></div>
        <div class="indicator" id="indicator02"></div>
        <div class="indicator" id="indicator03"></div>
        <div class="indicator" id="indicator04"></div>
        <div class="indicator" id="indicator05"></div>
        <div class="indicator" id="indicator06"></div>
        <div class="indicator" id="indicator07"></div>
    </div>
    <div id="tuesday" class="weekday ">
        <div class="indicator" id="indicator10"></div>
        <div class="indicator" id="indicator11"></div>
        <div class="indicator" id="indicator12"></div>
        <div class="indicator" id="indicator13"></div>
        <div class="indicator" id="indicator14"></div>
        <div class="indicator" id="indicator15"></div>
        <div class="indicator" id="indicator16"></div>
        <div class="indicator" id="indicator17"></div>
    </div>
    <div id="wednesday" class="weekday ">
        <div class="indicator" id="indicator20"></div>
        <div class="indicator" id="indicator21"></div>
        <div class="indicator" id="indicator22"></div>
        <div class="indicator" id="indicator23"></div>
        <div class="indicator" id="indicator24"></div>
        <div class="indicator" id="indicator25"></div>
        <div class="indicator" id="indicator26"></div>
        <div class="indicator" id="indicator27"></div>
    </div>
    <div id="thursday" class="weekday ">
        <div class="indicator" id="indicator30"></div>
        <div class="indicator" id="indicator31"></div>
        <div class="indicator" id="indicator32"></div>
        <div class="indicator" id="indicator33"></div>
        <div class="indicator" id="indicator34"></div>
        <div class="indicator" id="indicator35"></div>
        <div class="indicator" id="indicator36"></div>
        <div class="indicator" id="indicator37"></div>
    </div>
    <div id="friday" class="weekday ">
        <div class="indicator" id="indicator40"></div>
        <div class="indicator" id="indicator41"></div>
        <div class="indicator" id="indicator42"></div>
        <div class="indicator" id="indicator43"></div>
        <div class="indicator" id="indicator44"></div>
        <div class="indicator" id="indicator45"></div>
        <div class="indicator" id="indicator46"></div>
        <div class="indicator" id="indicator47"></div>
    </div>
    <div id="saturday" class="weekday ">
        <div class="indicator" id="indicator50"></div>
        <div class="indicator" id="indicator51"></div>
        <div class="indicator" id="indicator52"></div>
        <div class="indicator" id="indicator53"></div>
        <div class="indicator" id="indicator54"></div>
        <div class="indicator" id="indicator55"></div>
        <div class="indicator" id="indicator56"></div>
        <div class="indicator" id="indicator57"></div>
    </div>
    <div id="sunday" class="weekday ">
        <div class="indicator" id="indicator60"></div>
        <div class="indicator" id="indicator61"></div>
        <div class="indicator" id="indicator62"></div>
        <div class="indicator" id="indicator63"></div>
        <div class="indicator" id="indicator64"></div>
        <div class="indicator" id="indicator65"></div>
        <div class="indicator" id="indicator66"></div>
        <div class="indicator" id="indicator67"></div>
    </div>
</div>

<script>
    var clientId = "eafbdb4095514998ad2d06fe47f8db03";

    var renderHomePage = function () {
        var onLogin = function (user) {
            var matrix = new hightimes.UserActivityMatrix(3);

            hightimes.showDashboard(
                    $("#dashboard"),
                    user,
                    matrix
            );
        };

        hightimes.showLoginPage(
                $("#login-page"),
                onLogin
        );
    };

    var mockRequests = function () {
        $.ajax = function (params) {
            if (params.url.indexOf("/media/recent") != -1)  params.success(hightimes.mock.media);
            if (params.url.indexOf("/followed-by") != -1)  params.success(hightimes.mock.followers);
        };
    };

    var populateActivityMatrix = function (matrix) {
        mockRequests();

        var forEachFollowersDo = function (user) {
            console.log("Analyzing behaviour of " + user.full_name)
        };

        var forEachFollowerPostDo = function (user, post) {
            console.log(user.full_name + " posted " + post.type + " at " + post.created_time);
        };

        hightimes.forAllPostsOfFollowersDo("1924007889", forEachFollowersDo, forEachFollowerPostDo);
    };

    var makeMatrix = function () {
        var acitvity = new hightimes.UserActivityMatrix(3);
        var matrix = [[], [], [], [], [], [], []];
        matrix[0][7] = 7;
        matrix[1][7] = 1;
        matrix[3][7] = 7;
        matrix[4][7] = 4;
        matrix[5][7] = 7;
        matrix[6][7] = 4;

        matrix[1][1] = 5;
        matrix[2][2] = 1;
        matrix[3][3] = 7;

        acitvity.matrix = matrix;
        acitvity.average = function () {
            return 4;
        };
        return acitvity;
    };

    var renderDashboard = function (matrix) {
        setInterval(function () {
            var day = parseInt(((Math.random() * 7) % 7));
            var period = parseInt(((Math.random() * 8) % 8));
            var weigth = parseInt(((Math.random() * 8) % 8));
            matrix.matrix[day][period] = weigth;
        }, 1000);

        hightimes.showDashboard(
                $("#dashboard-page"),
                hightimes.mock.user,
                matrix
        );
    };

    var init = function () {
        hightimes.init(instagram.clientWith(clientId));
        var matrix = makeMatrix();
        populateActivityMatrix(matrix);
        renderDashboard(matrix);
    };

    $(document).ready(init);
</script>
<div id="select-user-dialog" class="modal-window hidden centered bg-high-blue hidden">
    <div class="close-modal btn bad-action">X</div>
    <p class="modal-message">Please select correct username to continue</p>
    <form >
        <div id="sample-option" class="username-option btn pull-left "> nishant.singh87</div>
    </form>
</div>
</body>
</html>