<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="css/app.css">
    <script src="js/lib/jquery.js"></script>

    <script src="js/hightimes.js"></script>
    <script src="js/promise.js"></script>
    <script src="js/instagram.js"></script>
    <script src="js/modal.js"></script>
</head>

<body>

<div id="login" class="centered img-background img-bg-blue-lit full-screen" action="">
    <img id="brand" src="images/hightimes-logo.gif" class="undo-image"/>

    <div class="attached-input-label">
        <input id="user-id" placeholder="Instgram Id" class="row"/>
        <button id="login-by-id">Go</button>
    </div>

    <div class="attached-input-label">
        <input id="username" placeholder="Instagram username" class="row"/>
        <button id="login-by-name">Go</button>
    </div>
</div>

<script>
    var userID = function () {
        return $("#user-id").val();
    };
    var username = function () {
        return $("#username").val();
    };

    var loginSucces = function(){
        alert("Working hard to do it.....errhhh...")
    };

    var toUserNames = function(users){
        var usernames = [];
        for(var i =0 ; i< users.length; i++){
            usernames.push(users[i].username)
        }
        return usernames;
    };

    var invalidUserId = function () {
        alert("Please enter a valid user id.");
    };

    var showModal = function (data) {
        var onSelect = function (index) {alert("selected : "+ data[index]);}
        window.hightimes.Modal.create($("#select-user-dialog"), data).show(onSelect);
    };

    var init = function () {
        hightimes.init();

        $("#login-by-id").mousedown(function(e){
            hightimes.findUserById(userID()).ok(loginSucces).error(invalidUserId);
        });

        $("#login-by-name").mousedown(function(e){
            hightimes.searchUsername(username()).ok(function (user) {
                console.log(user.full_name);
            }).error(function(users){
                showModal(toUserNames(users));
            });
        });
    };
    $(document).ready(init);
</script>
<div id="select-user-dialog" class="modal-window hidden centered bg-high-blue hidden">
    <div class="close-modal btn bad-action">X</div>
    <p class="modal-message">Please select correct username to continue</p>
    <form >
        <div id="sample-option" class="username-option btn pull-left "> nishant.singh87</div>
    </form>
</div>
</body>
</html>