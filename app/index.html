<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="css/app.css">
    <script src="js/lib/jquery.js"></script>

    <script src="js/hightimes.js"></script>
    <script src="js/user-activity-matrix.js"></script>
    <script src="js/promise.js"></script>
    <script src="js/instagram.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/views/login-page.js"></script>
</head>

<body>

<div id="login-page" class="centered img-background img-bg-blue-lit full-screen hidden" action="">
    <img id="brand" src="images/hightimes-logo.gif" class="undo-image"/>

    <div class="attached-input-label">
        <input id="user-id" placeholder="Instgram Id" class="row"/>
        <button id="login-by-id">Go</button>
    </div>

    <div class="attached-input-label">
        <input id="username" placeholder="Instagram username" class="row"/>
        <button id="login-by-name">Go</button>
    </div>
</div>

<div id="dashboard-page" class="centered img-background img-bg-blue-lit full-screen hidden" action="">

    <!--TODO instead of monday, counting must start fro msunday.-->
    <div id="monday"    class="weekday "><div class="indicator" id="indicator00"></div><div class="indicator" id="indicator01"></div><div class="indicator" id="indicator02"></div> <div class="indicator" id="indicator03"></div> <div class="indicator" id="indicator04"></div> <div class="indicator" id="indicator05"></div> <div class="indicator" id="indicator06"></div><div class="indicator" id="indicator07"></div> <div clas="day-label">Monday</div></div>
    <div id="tuesday"   class="weekday "><div class="indicator" id="indicator10"></div><div class="indicator" id="indicator11"></div><div class="indicator" id="indicator12"></div> <div class="indicator" id="indicator13"></div> <div class="indicator" id="indicator14"></div> <div class="indicator" id="indicator15"></div> <div class="indicator" id="indicator16"></div><div class="indicator" id="indicator17"></div> <div clas="day-label">Tuesday</div></div>
    <div id="wednesday" class="weekday "><div class="indicator" id="indicator20"></div><div class="indicator" id="indicator21"></div><div class="indicator" id="indicator22"></div> <div class="indicator" id="indicator23"></div> <div class="indicator" id="indicator24"></div> <div class="indicator" id="indicator25"></div> <div class="indicator" id="indicator26"></div><div class="indicator" id="indicator27"></div> <div clas="day-label">Wednesday</div></div>
    <div id="thursday"  class="weekday "><div class="indicator" id="indicator30"></div><div class="indicator" id="indicator31"></div><div class="indicator" id="indicator32"></div> <div class="indicator" id="indicator33"></div> <div class="indicator" id="indicator34"></div> <div class="indicator" id="indicator35"></div> <div class="indicator" id="indicator36"></div><div class="indicator" id="indicator37"></div> <div clas="day-label">Thursday</div></div>
    <div id="friday"    class="weekday "><div class="indicator" id="indicator40"></div><div class="indicator" id="indicator41"></div><div class="indicator" id="indicator42"></div> <div class="indicator" id="indicator43"></div> <div class="indicator" id="indicator44"></div> <div class="indicator" id="indicator45"></div> <div class="indicator" id="indicator46"></div><div class="indicator" id="indicator47"></div> <div clas="day-label">Friday</div></div>
    <div id="saturday"  class="weekday "><div class="indicator" id="indicator50"></div><div class="indicator" id="indicator51"></div><div class="indicator" id="indicator52"></div> <div class="indicator" id="indicator53"></div> <div class="indicator" id="indicator54"></div> <div class="indicator" id="indicator55"></div> <div class="indicator" id="indicator56"></div><div class="indicator" id="indicator57"></div> <div clas="day-label">Saturday</div></div>
    <div id="sunday"    class="weekday "><div class="indicator" id="indicator60"></div><div class="indicator" id="indicator61"></div><div class="indicator" id="indicator62"></div> <div class="indicator" id="indicator63"></div> <div class="indicator" id="indicator64"></div> <div class="indicator" id="indicator65"></div> <div class="indicator" id="indicator66"></div><div class="indicator" id="indicator67"></div> <div clas="day-label">Sunday</div></div>
</div>

<script>
    var init = function () {
        hightimes.init();

        var DashBoard = function($page, user, activityMatrix){

            var weight = function(value){
                if(!value) return 0;

                if(value > activityMatrix.average()) return  2;
                if(value < activityMatrix.average()) return 0;
                return 1;
            };

            var indicatorAt = function(day, period){
                return {"set": function(weight){
                    $("#indicator"+day+""+period).removeClass("indicator-level-0");
                    $("#indicator"+day+""+period).removeClass("indicator-level-1");
                    $("#indicator"+day+""+period).removeClass("indicator-level-2");

                    $("#indicator"+day+""+period).addClass("indicator-level-"+weight);
                }};
            };

            var render = function(){
                for(var day = 0; day < 7; day ++){
                    for(var period = 0; period < 8; period++){
                        var indicatorWeight = weight(activityMatrix.activityAt(day, period));
                        indicatorAt(day, period).set(indicatorWeight);
                    }
                }
            };

            this.show = function(){
                $page.show();
                setInterval(function(){
                    render();
                }, 1000);
            };
        };

//        var onLogin = function(){
//            new DashBoard($("#dashboard"), matrix).show();
//        };
//
//        hightimes.showLoginPage(
//                $("#login-page"),
//                onLogin
//        );

        var matrix = [[], [], [], [], [], [], []];
        matrix[0][7] = 4;
        matrix[1][7] = 3;
        matrix[3][7] = 5;
        matrix[4][7] = 4;
        matrix[5][7] = 5;
        matrix[6][7] = 4;

        matrix[1][1]  = 5;
        matrix[2][2]  = 1;
        matrix[3][3]  = 7;

        setInterval(function(){
            var day = parseInt(((Math.random() *  7)%7));
            var period = parseInt(((Math.random() *  8)%8));
            var weigth = parseInt(((Math.random() *  8)%8));
            matrix[day][period] = weigth;
        }, 1000);

        var FakeMatrix = function(matrix){
            this.activityAt = function(a, b){ return matrix[a][b]; }
            this.average    = function(){return 4};
            this.highest    = function(){return 7};
            this.lowest     = function(){return 0};
        };
        var fakeUser = {
            "username": "balajeevenkatesh",
            "bio": "",
            "website": "",
            "profile_picture": "https://igcdn-photos-c-a.akamaihd.net/hphotos-ak-xap1/t51.2885-19/10853151_412920515533426_1539642759_a.jpg",
            "full_name": "Balajee Venkatesh",
            "counts": {
                "media": 12,
                "followed_by": 231,
                "follows": 517
            },
            "id": "1267501370"
        };
        new DashBoard($("#dashboard-page"), fakeUser, new FakeMatrix(matrix)).show();
    };

    $(document).ready(init);
</script>
<div id="select-user-dialog" class="modal-window hidden centered bg-high-blue hidden">
    <div class="close-modal btn bad-action">X</div>
    <p class="modal-message">Please select correct username to continue</p>
    <form >
        <div id="sample-option" class="username-option btn pull-left "> nishant.singh87</div>
    </form>
</div>
</body>
</html>