<!DOCTYPE html>
<head>
    <script src="js/lib/jquery.js"></script>
    <script src="js/hightimes.js"></script>
    <script src="js/config.js"></script>
    <script src="js/instagram.js"></script>
</head>

<body>
<h1>Welcome</h1>
<p id="welcome">Wait while we load you profile....</p>
</body>
<script>
    $(document).ready(hightimes.login);




    var Page = function(data){
        this._data = data;
    };

    Page.prototype.hasNext = function(){
        return !!this._data.pagination.next_url;
    };

    Page.prototype.nextUrl = function(){
        return this._data.pagination.next_url;
    };


    Page.prototype.dataList = function(){
        return this._data.data;
    };



    var PagedResource = function(url){
        this.url = url;
    };

    PagedResource.prototype.fetchPage = function(url, onFetch){
        $.ajax({
            url: url,
            dataType: 'jsonp',
            type: 'GET',
            data: {client_id: "eafbdb4095514998ad2d06fe47f8db03"},
            success: onFetch,
            error: function (data) {
                console.log(data);
            }
        })
    };

    PagedResource.prototype.forEach = function(callback){
        var fetchPage = this.fetchPage;

        var load = function(url, fetchNextPage, callback){
            fetchNextPage(url, function (response) {
                var page = new Page(response);
                callback(page);
                if(page.hasNext()){
                    load(page.nextUrl(),fetchNextPage, callback)
                }
            })
        };

        load(this.url, fetchPage, callback);
    };


    var url = "https://api.instagram.com/v1/users/1442600494/media/recent?client_id=eafbdb4095514998ad2d06fe47f8db03&client_secret=5661da3c7c9f4a22a9c51d8129d2264b&access_token=1924007889.eafbdb4.0e2cf007b9d64f719ad1034ebd14bd68";

    new PagedResource(url).forEach(function(page){
        dataArr = page.dataList();
        for(var i =0; i<dataArr.length; i++){
            console.log(dataArr[i].created_time);
        }
    });




</script>
</html>