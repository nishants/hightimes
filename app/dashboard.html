<!DOCTYPE html>
<head>
    <script src="js/lib/jquery.js"></script>
    <script src="js/hightimes.js"></script>
    <script src="js/config.js"></script>
    <script src="js/instagram.js"></script>
    <script src="js/hightimes/page.js"></script>
    <script src="js/hightimes/paged-resource.js"></script>
    <script src="js/mock.js"></script>
</head>

<body>
<h1>Welcome</h1>
<p id="welcome">Wait while we load you profile....</p>
</body>
<script>

    var Page = hightimes.Page;
    var PagedResource = hightimes.PagedResource;

    var mockRequests = function(){
        $.ajax = function(params){
          if(params.url.indexOf("/media/recent") != -1)  params.success(hightimes.mock.media) ;
          if(params.url.indexOf("/followed-by")  != -1)  params.success(hightimes.mock.followers);
        };
    };

    var init = function(){
        mockRequests();
    };
    $(document).ready(init);


    var forAllPostsOfFollowersDo = function(userID, forEachFollowersDo, forEachFollowerPostDo){
        var url = "https://api.instagram.com/v1/users/<user-id>/followed-by".replace("<user-id>", userID);
        var pageCount =1;

        new PagedResource(url).forEach(function(page){
            console.log("Followers on page-" +(pageCount++)+" : ")
            var followers = page.dataList();
            for(var i =0; i < followers.length; i++){
                var follower = followers[i];
                forEachFollowersDo(follower);

                var userPostsUrl = "https://api.instagram.com/v1/users/<user-id>/media/recent".replace("<user-id>", follower.id);
                new PagedResource(userPostsUrl).forEach(function(page){
                    if(page.dataList()){
                        var posts = page.dataList();
                        for(var i =0; i<posts.length; i++){
                            forEachFollowerPostDo(follower, posts[i]);
                        }
                    }else {
                        console.error("no posts found for " + follower.id)
                    }
                });
            }
        });

    }
    var forEachFollowersDo = function(user){
        console.log("Analyzing behaviour of "+user.full_name)
    };

    var forEachFollowerPostDo = function(user, post){
        console.log(user.full_name+ " posted "+ post.type + " at "+post.created_time);
    };

    forAllPostsOfFollowersDo("1924007889", forEachFollowersDo, forEachFollowerPostDo);





</script>
</html>